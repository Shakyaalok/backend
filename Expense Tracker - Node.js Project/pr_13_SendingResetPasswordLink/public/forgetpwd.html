<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style/custom.css">
    <title>Login</title>
</head>
<script src='https://cdnjs.cloudflare.com/ajax/libs/axios/0.16.1/axios.min.js'></script>


<body>

    <div class="container-fluid">
        <div class="row gap-5">
            <div class="col-lg-5 col-md-6 BG-1 fixed-form">
                <form id="frmData">
                    <h1 class="text-center mb-4">Generate New Password</h1>
                    <h1 id="showMsg"></h1>
                    <div class="mb-3">


                        <div>
                            <label for="email" class="form-label">New password</label>
                            <input name="password" type="password" class="form-control" id="password" placeholder=" " required>
                            <div class="error">not a valid email </div>
                        </div>


                        <div>
                            <label for="password" class="form-label">Confirm password</label>
                            <input name="cpassword" type="password" class="form-control" id="cpassword" placeholder=" " required pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$">
                            <div class="error">Required a strong password</div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-success btn-green" id="reset-btn">submit </button>
                </form>

            </div>






        </div>

    </div>



    <script>
        const resetBtn = document.getElementById('reset-btn')
        resetBtn.addEventListener('click', reset);

        function reset() {

            // getting the if from url which we are passing--> but still there is an issue like id is like an number we want to ecrypt it also
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id')
                // console.log('id--->', id)

            const password = document.getElementById('password').value
            const cpassword = document.getElementById('cpassword').value

            if (password !== cpassword) {
                return 'password does not match'
            }


            // Encode the password using encodeURIComponent--> backend will automatically encyrpyt it (password)
            const encodedPassword = encodeURIComponent(password);




            axios.post(`http://localhost:4000/password/updatepassword/${id}?newpassword=${encodedPassword}`)
                .then((response) => {
                    // or
                    // window.location.href = '/login.html'
                    // or
                    alert('Your password has been successfully changed you can close this window now!')
                })
                .catch((err) => {
                    console.log('error in reseting the password', err)
                })

            document.getElementById('password').value = ""
            document.getElementById('cpassword').value = ""
        }
    </script>
    <script src="forgetPassword.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

</body>

</html>